<% content_for :heading do -%><%= t("myplaceonline.users.offline") %><% end -%>
<h1><%= t("myplaceonline.users.offline") %></h1>

<%= flashes! %>

<p><%= t("myplaceonline.users.offlinedescription") %></p>

<%= form_tag do %>
  <p id="offline_info"></p>
  <div><%= submit_tag t("myplaceonline.users.offlinecreate") %></div>
<% end %>

<script type="text/javascript">
onPageLoad(function() {
  if (window.localStorage) {
    $("#offline_info").html("Your browser supports local storage.");
    <% if !@data.nil? %>
    var exported = <%= raw(@data) %>;
    setMyplaceonlineSnapshot(exported);
    if (myp.inPhoneGap) {
      app.exported = exported;
      app.navigate(app.phonegapHomepage);
    }
    <% end %>
    var snapshot = getMyplaceonlineSnapshot();
    if (snapshot) {
      $("#offline_info").append(" The current offline snapshot was stored for " + location.hostname + " on " + snapshot.time);
      $("#offline_info").after("<p><a href='#' onclick='window.localStorage.removeItem(myp.snapshotKey); createSuccessNotification(\"Offline storage cleared.\"); refreshPage(); return false;'>Clear Snapshot</a></p>");
    } else {
      $("#offline_info").append(" There is no current offline snapshot.");
    }
  } else {
    $("#offline_info").html("Your browser does not support local storage.");
  }
});
</script>
