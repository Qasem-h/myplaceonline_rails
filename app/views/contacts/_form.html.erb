<%= f.fields_for :ref, obj.ref do |identity_fields| %>

  <%= myp_text_field identity_fields, :name, "myplaceonline.contacts.name", obj.name, autofocus %>
  <%= myp_date_field identity_fields, :birthday, "myplaceonline.contacts.birthday", obj.birthday %>
  <%= myp_text_area identity_fields, :notes, "myplaceonline.contacts.notes_edit", obj.notes %>
  
  <%=
    render layout: 'myplaceonline/childproperties', locals: {
      f: identity_fields,
      prefixes: [:contact, :ref_attributes, :identity_phones_attributes],
      heading: t("myplaceonline.identities.phones"),
      childproperties: obj.contact_identity.identity_phones,
      deletebutton: t("myplaceonline.identities.delete_phone"),
      addbutton: t("myplaceonline.identities.add_phone"),
      expanded: false,
      formjson: [
        {
          type: 'text',
          name: 'number',
          placeholder: t("myplaceonline.identities.phone"),
          primary: true
        }
      ]
    } do
  %>
    <%= myp_text_field @child_fields, :number, "myplaceonline.identities.phone", @childproperty.number, false, "primary_input" %>
  <% end %>

  <%=
    render layout: 'myplaceonline/childproperties', locals: {
      f: f,
      prefixes: [:contact, :conversations_attributes],
      heading: t("myplaceonline.contacts.conversations"),
      childproperties: obj.conversations,
      deletebutton: t("myplaceonline.contacts.delete_conversation"),
      addbutton: t("myplaceonline.contacts.add_conversation"),
      expanded: false,
      formjson: [
        {
          type: 'textarea',
          name: 'conversation',
          placeholder: t("myplaceonline.contacts.conversation"),
          primary: true
        }
      ]
    } do
  %>
    <%= myp_text_area @child_fields, :conversation, "myplaceonline.contacts.conversation", @childproperty.conversation, false, "primary_input" %>
  <% end %>

<% end %>
