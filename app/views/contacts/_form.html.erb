<%= f.fields_for :ref, obj.ref do |identity_fields| %>

  <%= myp_text_field identity_fields, :name, "myplaceonline.contacts.name", obj.name, autofocus %>
  <%= myp_date_field identity_fields, :birthday, "myplaceonline.contacts.birthday", obj.birthday %>
  <%= myp_text_area_markdown identity_fields, :notes, "myplaceonline.contacts.notes", obj.notes %>
  
  <%=
    render layout: 'myplaceonline/childproperties', locals: {
      f: identity_fields,
      heading: t("myplaceonline.identities.emails"),
      childpropertiesname: :identity_emails,
      childproperties: obj.contact_identity.identity_emails,
      deletebutton: t("myplaceonline.identities.delete_email"),
      addbutton: t("myplaceonline.identities.add_email"),
      expanded: obj.contact_identity.identity_emails.length > 0,
      formjson: [
        {
          type: 'text',
          name: 'email',
          placeholder: t("myplaceonline.identities.email"),
          autofocus: true
        }
      ]
    } do
  %>
    <%= myp_text_field @child_fields, :email, "myplaceonline.identities.email", @childproperty.email %>
  <% end %>

  <%=
    render layout: 'myplaceonline/childproperties', locals: {
      f: identity_fields,
      heading: t("myplaceonline.identities.phones"),
      childpropertiesname: :identity_phones,
      childproperties: obj.contact_identity.identity_phones,
      deletebutton: t("myplaceonline.identities.delete_phone"),
      addbutton: t("myplaceonline.identities.add_phone"),
      expanded: obj.contact_identity.identity_phones.length > 0,
      formjson: [
        {
          type: 'text',
          name: 'number',
          placeholder: t("myplaceonline.identities.phone"),
          autofocus: true
        }
      ]
    } do
  %>
    <%= myp_text_field @child_fields, :number, "myplaceonline.identities.phone", @childproperty.number %>
  <% end %>

  <%=
    render layout: 'myplaceonline/childproperties', locals: {
      f: f,
      heading: t("myplaceonline.contacts.conversations"),
      childpropertiesname: :conversations,
      childproperties: obj.conversations,
      deletebutton: t("myplaceonline.contacts.delete_conversation"),
      addbutton: t("myplaceonline.contacts.add_conversation"),
      expanded: obj.conversations.length > 0,
      formjson: [
        {
          type: 'textarea',
          name: 'conversation',
          placeholder: t("myplaceonline.contacts.conversation"),
          autofocus: true
        }
      ]
    } do
  %>
    <%= myp_text_area @child_fields, :conversation, "myplaceonline.contacts.conversation", @childproperty.conversation %>
  <% end %>

<% end %>
