<%= myp_text_field f, :name, "myplaceonline.therapists.name", obj.name, autofocus %>
<%= myp_text_area_markdown f, :notes, "myplaceonline.therapists.notes", obj.notes %>
<%=
  render layout: 'myplaceonline/childproperties', locals: {
    f: f,
    heading: t("myplaceonline.therapists.conversations"),
    childpropertiesname: :therapist_conversations,
    childproperties: obj.all_conversations,
    deletebutton: t("myplaceonline.therapists.delete_conversation"),
    addbutton: t("myplaceonline.therapists.add_conversation"),
    expanded: false,
    formjson: [
      {
        type: 'textarea',
        name: 'conversation',
        placeholder: t("myplaceonline.therapists.conversation"),
        autofocus: true
      },
      {
        type: 'date',
        name: 'conversation_date',
        placeholder: t("myplaceonline.therapists.conversation_date"),
        value: Date.today.to_s
      }
    ]
  } do |child_fields, childproperty|
%>
  <%= myp_text_area child_fields, :conversation, "myplaceonline.therapists.conversation", childproperty.conversation %>
  <%= myp_date_field child_fields, :conversation_date, "myplaceonline.therapists.conversation_date", childproperty.conversation_date %>
<% end %>
<%=
  render layout: 'myplaceonline/childproperties', locals: {
    f: f,
    heading: t("myplaceonline.identities.emails"),
    childpropertiesname: :therapist_emails,
    childproperties: obj.therapist_emails,
    deletebutton: t("myplaceonline.identities.delete_email"),
    addbutton: t("myplaceonline.identities.add_email"),
    expanded: obj.therapist_emails.length > 0,
    formjson: [
      {
        type: 'text',
        name: 'email',
        placeholder: t("myplaceonline.identities.email"),
        autofocus: true
      }
    ]
  } do |child_fields, childproperty|
%>
  <%= myp_text_field child_fields, :email, "myplaceonline.identities.email", childproperty.email %>
<% end %>
<%=
  render layout: 'myplaceonline/childproperties', locals: {
    f: f,
    heading: t("myplaceonline.identities.phones"),
    childpropertiesname: :therapist_phones,
    childproperties: obj.therapist_phones,
    deletebutton: t("myplaceonline.identities.delete_phone"),
    addbutton: t("myplaceonline.identities.add_phone"),
    expanded: obj.therapist_phones.length > 0,
    formjson: [
      {
        type: 'text',
        name: 'number',
        placeholder: t("myplaceonline.identities.phone"),
        autofocus: true
      },
      {
        type: 'select',
        name: 'phone_type',
        options: IdentityPhone::PHONE_TYPES.map{|x,y| [I18n.t(x),y]}.as_json,
        placeholder: t("myplaceonline.identity_phones.phone_type")
      }
    ]
  } do |child_fields, childproperty|
%>
  <%= myp_text_field child_fields, :number, "myplaceonline.identities.phone", childproperty.number %>
  <%= myp_select(child_fields, :phone_type, "myplaceonline.identity_phones.phone_type", Myp.translate_options(IdentityPhone::PHONE_TYPES), childproperty.phone_type) %>
<% end %>
<%=
  render layout: 'myplaceonline/childproperties', locals: {
    f: f,
    heading: t("myplaceonline.identities.locations"),
    childpropertiesname: :therapist_locations,
    childproperties: obj.therapist_locations,
    deletebutton: t("myplaceonline.identities.delete_location"),
    addbutton: t("myplaceonline.identities.add_location"),
    expanded: obj.therapist_locations.length > 0,
    formjson: [
      {
        type: :renderpartial,
        name: :location_attributes,
        partial: 'myplaceonline/select_or_create',
        heading: t("myplaceonline.identities.location"),
        objform: "locations/form",
        existingobjurl: "location_path",
        searchurl: "/locations.json?perpage=0",
        edit: false,
        autofocus: true
      }
    ]
  } do |child_fields, childproperty|
%>
  <%=
    render partial: 'myplaceonline/select_or_create', locals: {
      f: child_fields,
      name: :location_attributes,
      existingobj: childproperty.location,
      heading: t("myplaceonline.identities.location"),
      objform: "locations/form",
      existingobjurl: "location_path",
      searchurl: "/locations.json?perpage=0",
      edit: edit,
      autofocus: false
    }
  %>
<% end %>
