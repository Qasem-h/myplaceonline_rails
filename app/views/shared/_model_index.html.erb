<% if !@myplet %>
  <% content_for :heading do -%><%= t("myplaceonline.category." + controller.category_name) %><% end -%>
  <%= flashes! %>
<% end %>

<% if !controller.has_items %>

  <p><%= t("myplaceonline.general.count_no") + " " + t("myplaceonline.category." + controller.category_name) %>.
    <% if controller.show_index_footer %>
      <% if !@myplet %>
        <%= t("myplaceonline.general.create_instructions") %>
      <% end %>
    <% end %>
  </p>

<% else %>

  <% if !@additional_items.nil? && @additional_items.count > 0 %>

    <div data-role="collapsible" data-collapsed="true">
      <h3><%= t("myplaceonline.general.top_items", max: controller.how_many_top_items) %></h3>
      <ul data-role="listview" data-inset="true">
        <%
        @additional_items.each do |obj|
        %>
          <li>
            <%= link_to controller.display_obj(obj), send("#{controller.path_name}_path", obj) %>
          </li>
        <% end %>
      </ul>
    </div>

  <% end %>

  <div class="searchable_container">
    <ul class="searchable" data-role="listview" data-inset="true" data-filter="true" data-split-icon="<%= controller.data_split_icon %>">
      <%
      if !@objs2.nil? && controller.second_list_before
        @objs2.each do |obj|
      %>
          <li>
            <%= link_to send("#{controller.second_path_name}_path", obj) do %>
              <%= controller.second_list_icon(obj) %>
              <%= controller.display_obj(obj) %>
            <% end %>
          </li>
      <%
        end
      end
      %>
      <%
      @objs.each do |obj|
      %>
        <li>
          <%= link_to((controller.display_obj(obj) + controller.display_obj_bubble(obj)).html_safe, controller.show_path(obj)) %>
          <%= controller.split_link(obj) %>
        </li>
      <%
      end
      %>
      <%
      if !@objs2.nil? && !controller.second_list_before
        @objs2.each do |obj|
      %>
          <li>
            <%= link_to send("#{controller.second_path_name}_path", obj) do %>
              <%= controller.second_list_icon(obj) %>
              <%= controller.display_obj(obj) %>
            <% end %>
          </li>
      <%
        end
      end
      %>
    </ul>
  </div>

  <% if @offset + @perpage < @count %>
    <%= link_to(t('myplaceonline.general.next') + " " + @perpage.to_s, send("#{controller.paths_name}_path", :offset => @offset + @perpage), :class => "ui-btn") %>
  <% end %>

  <% if @offset > 0 %>
    <%= link_to(t('myplaceonline.general.previous') + " " + @perpage.to_s, send("#{controller.paths_name}_path", :offset => @offset - @perpage), :class => "ui-btn") %>
  <% end %>

  <% if @count > @perpage %>
    <div class="horizontal_center small">
      <%= @count %> <%= t("myplaceonline.category." + controller.category_name) %>, <%= @perpage %> <%= t("myplaceonline.general.perpage") %> (<%= link_to(t("myplaceonline.general.all"), "/" + controller.paths_name + @query_params_part_all) %>)
    </div>
  <% end %>

  <script type="text/javascript">
    myplaceonline.onPageLoad(function() {
      myplaceonline.hookListviewSearch($(".searchable"), "/<%= controller.paths_name %>.json<%= raw(@query_params_part_all) %>");
      var input = $(".searchable_container input");
      myplaceonline.hookListviewEnter(input, ".searchable");
      <% if !@myplet %>
      myplaceonline.maybeFocus(input);
      <% end %>
    });
  </script>

<% end %>

<% if @myplet %>
  <p><%= link_to t("myplaceonline.general.add") + " " + t("myplaceonline.category." + controller.category_name).singularize, controller.new_path, "class" => "ui-btn" %></p>
<% end %>

<%= yield %>

<% if !@myplet %>
  <% content_for :footer do -%>
    <% if controller.show_index_footer %>
      <div data-role="footer" data-position="fixed" data-tap-toggle="false">
          <div data-role="navbar">
            <ul>
              <% if content_for?(:allfooterlinks) %>
                <%= content_for(:allfooterlinks) %>
              <% else %>
                <li><%= link_to t("myplaceonline.general.add") + " " + t("myplaceonline.category." + controller.category_name).singularize, controller.new_path, "data-icon" => "plus" %></li>
                <%= content_for(:footerlinks) %>
              <% end %>
            </ul>
          </div>
      </div>
    <% end %>
  <% end -%>
<% end %>