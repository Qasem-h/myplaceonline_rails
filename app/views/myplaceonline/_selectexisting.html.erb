<%= f.fields_for name, existingobj do |sub_fields| %>
  <div data-role="collapsible" data-collapsed="false">
    <h4><%= heading %></h4>
    <div data-role="collapsible-set">
      <div data-role="collapsible" data-collapsed="false">
        <h3><%= t("myplaceonline.general.existing") + " " + heading %></h3>
        <div class="<%= fieldid %>_searchable_container">
          <ul class="<%= fieldid %>_searchable" data-role="listview" data-inset="true" data-filter="true" data-icon="false" data-filter-placeholder="<%= t("myplaceonline.search.placeholder") %>">
            <% if !existingobj.nil? && !existingobj.id.nil? %>
              <li>
                <%= link_to existingobj.display, send(existingobjurl, existingobj), onclick: Myp.select_listitem('#' + fieldid) %>
              </li>
            <% end %>
          </ul>
        </div>
        <%= hidden_field_tag fieldid %>
        <script type="text/javascript">
          onPageLoad(function() {
            $(".<%= fieldid %>_searchable li").each(function(index) {
              $(this).addClass('ui-btn-active');
            });
            hookListviewSearch($(".<%= fieldid %>_searchable"), "<%= searchurl %>", function(ul) {
              ul.find("li a").each(function(index) {
                $(this).attr("onclick", "<%= raw(Myp.select_listitem('#' + fieldid)) %>");
              });
            });
            //maybeFocus($(".<%= fieldid %>_searchable_container input"));
          });
        </script>
      </div>
      <div data-role="collapsible">
        <h3><%= (edit ? t("myplaceonline.general.edit") : t("myplaceonline.general.new")) + " " + heading %></h3>
        <%= render partial: objform, locals: { f: sub_fields, obj: existingobj, edit: edit, toplevel: false } %>
      </div>
    </div>
  </div>
<% end %>
