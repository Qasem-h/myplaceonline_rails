<% content_for :heading do -%><%= @obj.display %><% end -%>
<h1><%= @obj.display %></h1>
<% if !@obj.identity_file.nil? %>
  <%= url_or_blank(file_download_path(@obj.identity_file, token: params[:token]), t("myplaceonline.playlists.download_zip") + " (" + bytes_number(@obj.identity_file.file_file_size) + ")", nil, "ui-btn ui-btn-inline", true) %>
<% end %>
<ol class="playlist_songs">
  <% @obj.playlist_songs.each do |playlist_song| %>
    <% if !playlist_song.song.identity_file.nil? %>
      <li>
        <p><%= playlist_song.song.display %></p>
        <%= raw(file_audio(playlist_song.song.identity_file)) %>
      </li>
    <% end %>
  <% end %>
</ol>

<script type="text/javascript">
$("audio").each(function() {
  $(this).on("ended", function() {
    var li = $(this).parent("li");
    var search = li[0].nextElementSibling;
    while (search) {
      if (search.tagName && search.tagName.toLowerCase() == "li") {
        var nextAudio = $(search).find("audio");
        if (nextAudio.length) {
          nextAudio[0].play();
          break;
        }
      }
      search = search.nextElementSibling;
    }
  });
});
</script>

<div data-role="footer" data-position="fixed" data-tap-toggle="false">
  <div data-role="navbar">
    <ul>
      <li><a href="#" data-icon="arrow-l" onclick="myplaceonline.playPreviousSong('.playlist_songs'); return false;"><%= t('myplaceonline.playlists.play_previous') %></a></li>
      <li><a href="#" data-icon="bars" onclick="myplaceonline.playFirstSong('.playlist_songs'); return false;"><%= t('myplaceonline.playlists.play_all') %></a></li>
      <li><a href="#" data-icon="arrow-r" onclick="myplaceonline.playNextSong('.playlist_songs'); return false;"><%= t('myplaceonline.playlists.play_next') %></a></li>
    </ul>
  </div>
</div>